name: Code Formatting

on:
  pull_request:
    paths:
      - '**.nix'
  push:
    branches:
      - master
    paths:
      - '**.nix'
  workflow_dispatch:

jobs:
  check-formatting:
    name: Check Nix formatting
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - uses: DeterminateSystems/nix-installer-action@main

      - name: Check formatting
        run: |
          echo "üé® Checking Nix code formatting..."
          if nix fmt -- --fail-on-change .; then
            echo "‚úÖ All files properly formatted"
          else
            echo "‚ùå Formatting issues found"
            echo ""
            echo "To fix locally, run:"
            echo "  nix fmt ."
            echo "  # OR: ./scripts/fmt.sh"
            echo ""
            exit 1
          fi
