# Desktop Theming

## Overview

axiOS uses [DankMaterialShell](https://github.com/AvengeMedia/DankMaterialShell) with [Niri compositor](https://github.com/YaLTeR/niri) to provide a cohesive Material Design-inspired desktop experience with automatic theming.

## Theming Architecture (DMS-First Approach)

axiOS now relies primarily on DMS's built-in template management system for application theming. You control which applications receive dynamic theming via **DMS Control Panel → Matugen Templates** checkboxes.

**DMS-Managed Applications:**

- VS Code (three theme variants)
- KDE color schemes (dark/light/default)
- Qt applications (qt5ct, qt6ct)
- GTK applications
- Terminal emulators (Ghostty, kitty, foot, alacritty, wezterm)
- Browsers (Firefox via pywalfox)
- Other apps (vesktop, equibop, dgop, niri)

**axios-Only Theming:**

- Kate syntax highlighting (code editor text styles - not redundant with DMS).  This is currently disabled as it conflicts with DMS.  TODO: Bring it back

### Reverting to axios-Managed Templates

If DMS template management fails, you can revert to the legacy axios-managed system:

1. Add to your home-manager configuration:
   ```nix
   axios.theming.useAxiosTemplates = true;
   ```

## DankMaterialShell Features

- Material Design-inspired theming
- Automatic color generation from wallpapers
- Dynamic application theming
- Custom keybindings and shortcuts
- Enhanced overview mode with visual effects

## Wallpaper Blur for Overview Mode

axiOS provides a wallpaper blur script that creates a blurred version of your wallpaper for Niri's overview background.

### Setup Instructions

To enable automatic wallpaper blur when changing wallpapers:

1. **Enable the DankHooks Plugin:**
   - Open DankMaterialShell settings
   - Navigate to **Plugins**
   - Find **Dank Hooks** and click **Enable**

2. **Configure the Wallpaper Hook:**
   - In the DankHooks plugin settings, find **Wallpaper Changed**
   - Set the hook path to: `~/scripts/wallpaper-changed.sh`
   - The script is automatically deployed to your home directory by axiOS

The hook will now automatically:
1. Detect when wallpaper changes
2. Generate a blurred version using ImageMagick
3. Save it to `~/.cache/niri/overview-blur.jpg`
4. Display it using `swaybg` as the overview background

### Manual Testing

Test the wallpaper blur generation:

```bash
~/scripts/wallpaper-changed.sh "onWallpaperChanged" "/path/to/wallpaper.jpg"
```

### Troubleshooting

**Blurred background not appearing:**
1. Verify DankHooks plugin is enabled in DMS settings
2. Check that the wallpaper hook path is correctly configured to `~/scripts/wallpaper-changed.sh`
3. Ensure `~/.cache/niri/overview-blur.jpg` exists after changing wallpapers
4. Verify ImageMagick is installed: `which magick`
5. Check that swaybg is running: `ps aux | grep swaybg`

## Niri Overview Mode

To activate the overview mode and see the blurred background:
- Press `Super+Tab` (or your configured keybinding)
- The blurred wallpaper appears as the backdrop
- All windows are shown in a grid layout

## Ghostty Theming

Ghostty uses DMS's official theming system.

### Setup (DMS-Managed)

**Default configuration:**
- **Theme file**: `~/.config/ghostty/themes/dankcolors` (auto-generated by DMS)
- **Enabled in**: DMS Control Panel → Matugen Templates → Ghostty checkbox
- **Auto-reload**: Ghostty auto-reloads when the theme file changes

### How It Works

1. DMS generates the `dankcolors` theme file in `~/.config/ghostty/themes/` via matugen.
2. Ghostty's config file (`~/.config/ghostty/config`) imports this theme file.
3. When you change your wallpaper, DMS updates the theme file and Ghostty reloads automatically.



## VSCode Theming

VSCode uses DMS's official theming system with three theme variants.

### Setup (DMS-Managed)

**Default configuration:**

- **Extension**: DMS - Dank Material Shell Theme (managed by DMS)
- **Extension ID**: `danklinux.dms-theme`
- **Theme variants**: Default (auto), Dark, Light
- **Theme files**: `~/.vscode/extensions/danklinux.dms-theme-0.0.3/themes/` (auto-generated by DMS)
- **Enabled in**: DMS Control Panel → Matugen Templates → VS Code checkbox
- **Auto-reload**: Extension watches theme files and auto-reloads on change

### How to Use

1. Open VSCode Command Palette: `Ctrl+Shift+P`
2. Select: **Preferences: Color Theme**
3. Choose one of:
   - **Dynamic Base16 DankShell** - Follows system light/dark mode
   - **Dynamic Base16 DankShell (Dark)** - Always dark
   - **Dynamic Base16 DankShell (Light)** - Always light

The theme updates automatically when you change wallpapers.

### How It Works

1. DMS generates three theme JSON files from wallpaper colors via matugen
2. VSCode extension watches the theme files directory
3. When themes update, extension automatically reloads colors
4. No manual intervention needed

### Troubleshooting

**Theme not available in VSCode:**

1. Verify DMS checkbox enabled: DMS Control Panel → Matugen Templates → VS Code
2. Check if theme files exist:

   ```bash
   ls -la ~/.vscode/extensions/danklinux.dms-theme-0.0.3/themes/
   ```

   Should show: `dankshell-default.json`, `dankshell-dark.json`, `dankshell-light.json`

3. Change wallpaper to trigger DMS theme generation
4. Restart VSCode if themes still don't appear

**Colors not updating:**

1. Change wallpaper to trigger DMS theme generation
2. Extension should auto-reload within a few seconds
3. Check VSCode output panel (View → Output → select "Dynamic Base16 DankShell")
4. Manually trigger reload: `Ctrl+Shift+P` → `Developer: Reload Window`

**Extension not installed:**

VSCode should automatically detect the extension. If not:

```bash
# Verify extension directory exists
ls -la ~/.vscode/extensions/danklinux.dms-theme-0.0.3/

# Check extension registration
cat ~/.vscode/extensions/extensions.json | jq '.[] | select(.identifier.id == "danklinux.dms-theme")'
```

If missing, run:

```bash
home-manager switch
```

**Note**: If you had the old extension (`local.dynamic-base16-dankshell`), it will be automatically removed during the next home-manager switch.

**Manual theme generation:**

```bash
matugen generate
```

## Application Theming

For more information about how applications are themed in DankMaterialShell, see the [DankLinux documentation](https://danklinux.com/docs/dankmaterialshell/application-themes).

## Related Files

- `home/desktop/wallpaper.nix` - Wallpaper blur setup
- `home/desktop/niri.nix` - Niri compositor configuration
- `home/desktop/default.nix` - DankMaterialShell integration
- `home/desktop/theming.nix` - Theme configuration

## References

- [DankMaterialShell](https://github.com/AvengeMedia/DankMaterialShell)
- [Niri Compositor](https://github.com/YaLTeR/niri)
- [DankLinux Application Theming](https://danklinux.com/docs/dankmaterialshell/application-themes)


