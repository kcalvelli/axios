# Desktop Theming

## Overview

axiOS uses [DankMaterialShell](https://github.com/AvengeMedia/DankMaterialShell) with [Niri compositor](https://github.com/YaLTeR/niri) to provide a cohesive Material Design-inspired desktop experience with automatic theming.

## Theming Architecture (DMS-First Approach)

axiOS now relies primarily on DMS's built-in template management system for application theming. You control which applications receive dynamic theming via **DMS Control Panel → Matugen Templates** checkboxes.

**DMS-Managed Applications:**

- Neovim (via `RRethy/base16-nvim` plugin)
- VS Code (three theme variants)
- KDE color schemes (dark/light/default)
- Qt applications (qt5ct, qt6ct)
- GTK applications
- Terminal emulators (Ghostty, kitty, foot, alacritty, wezterm)
- Browsers (Firefox via pywalfox)
- Other apps (vesktop, equibop, dgop, niri)

**axios-Only Theming:**

- Kate syntax highlighting (code editor text styles - not redundant with DMS)

### Reverting to axios-Managed Templates

If DMS template management fails, you can revert to the legacy axios-managed system:

1. Add to your home-manager configuration:
   ```nix
   axios.theming.useAxiosTemplates = true;
   ```
2. Uncomment custom template lines in `home/terminal/neovim.nix`
3. Run `home-manager switch`

This restores axios's custom neovim template and manual template registration.

## DankMaterialShell Features

- Material Design-inspired theming
- Automatic color generation from wallpapers
- Dynamic application theming
- Custom keybindings and shortcuts
- Enhanced overview mode with visual effects

## Wallpaper Blur for Overview Mode

axiOS provides a wallpaper blur script that creates a blurred version of your wallpaper for Niri's overview background.

### Setup Instructions

To enable automatic wallpaper blur when changing wallpapers:

1. **Enable the DankHooks Plugin:**
   - Open DankMaterialShell settings
   - Navigate to **Plugins**
   - Find **Dank Hooks** and click **Enable**

2. **Configure the Wallpaper Hook:**
   - In the DankHooks plugin settings, find **Wallpaper Changed**
   - Set the hook path to: `~/scripts/wallpaper-changed.sh`
   - The script is automatically deployed to your home directory by axiOS

The hook will now automatically:
1. Detect when wallpaper changes
2. Generate a blurred version using ImageMagick
3. Save it to `~/.cache/niri/overview-blur.jpg`
4. Display it using `swaybg` as the overview background

### Manual Testing

Test the wallpaper blur generation:

```bash
~/scripts/wallpaper-changed.sh "onWallpaperChanged" "/path/to/wallpaper.jpg"
```

### Troubleshooting

**Blurred background not appearing:**
1. Verify DankHooks plugin is enabled in DMS settings
2. Check that the wallpaper hook path is correctly configured to `~/scripts/wallpaper-changed.sh`
3. Ensure `~/.cache/niri/overview-blur.jpg` exists after changing wallpapers
4. Verify ImageMagick is installed: `which magick`
5. Check that swaybg is running: `ps aux | grep swaybg`

## Niri Overview Mode

To activate the overview mode and see the blurred background:
- Press `Super+Tab` (or your configured keybinding)
- The blurred wallpaper appears as the backdrop
- All windows are shown in a grid layout

## Neovim Theming

Neovim uses DMS's official theming system via the `RRethy/base16-nvim` plugin.

### Setup (DMS-Managed)

**Default configuration:**
- **Plugin**: `RRethy/base16-nvim` (automatically installed by axios)
- **Theme file**: `~/.config/nvim/lua/plugins/dankcolors.lua` (auto-generated by DMS)
- **Enabled in**: DMS Control Panel → Matugen Templates → neovim checkbox
- **Auto-reload**: File watcher automatically updates theme on wallpaper change

### How It Works

1. DMS generates `dankcolors.lua` from wallpaper colors via matugen
2. `RRethy/base16-nvim` plugin loads the base16 color scheme
3. File watcher automatically reloads when theme changes
4. No manual intervention needed

### Troubleshooting

**Theme not loading:**

1. Verify DMS checkbox enabled: DMS Control Panel → Matugen Templates → neovim
2. Check if plugin file exists:
   ```bash
   ls ~/.config/nvim/lua/plugins/dankcolors.lua
   ```
3. Verify plugin is installed: `:Lazy` in neovim, look for "base16-nvim"
4. Change wallpaper to trigger theme generation

**Colors not updating:**

1. Change wallpaper to trigger DMS theme generation
2. File watcher should auto-reload (look for "Matugen: Colors reloaded!" message)
3. Manually reload if needed: `:lua dofile(vim.fn.stdpath("config") .. "/lua/plugins/dankcolors.lua")`

**Manual theme generation:**

```bash
matugen generate
```

### Legacy: axios Custom Template

axiOS previously provided a custom `base16-vim.mustache` template. This is now disabled by default in favor of DMS's official handler.

**To revert to axios custom template:**

1. Add to your home-manager configuration:
   ```nix
   axios.theming.useAxiosTemplates = true;
   ```
2. Uncomment template deployment in `home/terminal/neovim.nix`
3. Uncomment colorscheme loader in `home/terminal/neovim.nix`
4. Run `home-manager switch`

## VSCode Theming

VSCode uses DMS's official theming system with three theme variants.

### Setup (DMS-Managed)

**Default configuration:**

- **Extension**: Dynamic Base16 DankShell (managed by DMS)
- **Theme variants**: Default (auto), Dark, Light
- **Theme files**: `~/.vscode/extensions/local.dynamic-base16-dankshell-0.0.1/themes/` (auto-generated by DMS)
- **Enabled in**: DMS Control Panel → Matugen Templates → VS Code checkbox
- **Auto-reload**: Extension watches theme files and auto-reloads on change

### How to Use

1. Open VSCode Command Palette: `Ctrl+Shift+P`
2. Select: **Preferences: Color Theme**
3. Choose one of:
   - **Dynamic Base16 DankShell** - Follows system light/dark mode
   - **Dynamic Base16 DankShell (Dark)** - Always dark
   - **Dynamic Base16 DankShell (Light)** - Always light

The theme updates automatically when you change wallpapers.

### How It Works

1. DMS generates three theme JSON files from wallpaper colors via matugen
2. VSCode extension watches the theme files directory
3. When themes update, extension automatically reloads colors
4. No manual intervention needed

### Troubleshooting

**Theme not available in VSCode:**

1. Verify DMS checkbox enabled: DMS Control Panel → Matugen Templates → VS Code
2. Check if theme files exist:

   ```bash
   ls -la ~/.vscode/extensions/local.dynamic-base16-dankshell-0.0.1/themes/
   ```

   Should show: `dankshell-default.json`, `dankshell-dark.json`, `dankshell-light.json`

3. Change wallpaper to trigger DMS theme generation
4. Restart VSCode if themes still don't appear

**Colors not updating:**

1. Change wallpaper to trigger DMS theme generation
2. Extension should auto-reload within a few seconds
3. Check VSCode output panel (View → Output → select "Dynamic Base16 DankShell")
4. Manually trigger reload: `Ctrl+Shift+P` → `Developer: Reload Window`

**Extension not installed:**

VSCode should automatically detect the extension. If not:

```bash
# Verify extension directory exists
ls -la ~/.vscode/extensions/local.dynamic-base16-dankshell-0.0.1/

# Check extension registration
cat ~/.vscode/extensions/extensions.json | jq '.[] | select(.identifier.id == "local.dynamic-base16-dankshell")'
```

If missing, run:

```bash
home-manager switch
```

**Manual theme generation:**

```bash
matugen generate
```

## Application Theming

For more information about how applications are themed in DankMaterialShell, see the [DankLinux documentation](https://danklinux.com/docs/dankmaterialshell/application-themes).

## Related Files

- `home/desktop/wallpaper.nix` - Wallpaper blur setup
- `home/desktop/niri.nix` - Niri compositor configuration
- `home/desktop/default.nix` - DankMaterialShell integration
- `home/desktop/theming.nix` - Theme configuration

## References

- [DankMaterialShell](https://github.com/AvengeMedia/DankMaterialShell)
- [Niri Compositor](https://github.com/YaLTeR/niri)
- [DankLinux Application Theming](https://danklinux.com/docs/dankmaterialshell/application-themes)


