# Fix: PWA Launcher Missing Browser Hardware Acceleration Flags

## Type
Defect fix

## Problem

PWA launcher scripts generated by `home/desktop/pwa-apps.nix` do not include
the hardware acceleration flags defined in `modules/desktop/browsers.nix`.
This means every PWA runs without GPU rasterization, VA-API decode, or
zero-copy — degrading video playback and rendering performance compared to
launching the same URL in the browser directly.

### Root Cause

`browsers.nix` computes `braveArgs` and `chromeArgs` as local `let` bindings
from `config.axios.hardware.gpuType`. These values are applied to
`programs.brave.commandLineArgs` and `programs.google-chrome.commandLineArgs`
but are **never exposed as options** that other modules can consume.

`pwa-apps.nix` (a home-manager module) constructs launcher exec lines with
only PWA-specific flags (`--app=`, `--class=`, `--user-data-dir=`), with no
mechanism to receive the acceleration flags.

### Additional Gap

Chromium — the **default** PWA browser (`axios.pwa.browser = "chromium"`) — is
not configured in `browsers.nix` at all, so it has no acceleration flags even
when launched normally.

## Affected Code

| File | Role |
|------|------|
| `modules/desktop/browsers.nix` | Computes GPU-aware flags; does not expose them |
| `home/desktop/pwa-apps.nix` | Generates PWA launchers; no access to flags |

## Solution

Expose the computed browser command-line args as a NixOS-level option so that
`pwa-apps.nix` can read them via `osConfig`.

### Design

1. **`browsers.nix`** — Add `desktop.browserArgs` option (attrsOf listOf str)
   that maps browser names to their computed flag lists. Also add Chromium to
   the configuration with the same acceleration flags.

   ```nix
   options.desktop.browserArgs = lib.mkOption {
     type = lib.types.attrsOf (lib.types.listOf lib.types.str);
     readOnly = true;
     description = "Computed browser command-line arguments (GPU-aware). Read-only.";
   };

   config.desktop.browserArgs = {
     brave = braveArgs;
     chromium = chromeArgs;
     google-chrome = chromeArgs;
   };
   ```

2. **`pwa-apps.nix`** — Read `osConfig.desktop.browserArgs` and prepend the
   flags to every PWA launcher exec line.

   ```nix
   browserArgs = osConfig.desktop.browserArgs or {};
   argsFor = browser: browserArgs.${browser} or [];
   argsStr = browser: lib.concatStringsSep " " (argsFor browser);
   ```

   The `makeLauncher` function and desktop entry action exec lines then include
   `${argsStr browser}` before `--app=`.

### Result

PWA launchers will produce commands like:
```
exec brave --password-store=detect --ignore-gpu-blocklist \
  --enable-gpu-rasterization --enable-zero-copy \
  --enable-native-gpu-memory-buffers \
  --enable-features=AcceleratedVideoEncoder,... \
  --user-data-dir=... --class=... "--app=https://..."
```

Identical flags to a normal browser launch.
